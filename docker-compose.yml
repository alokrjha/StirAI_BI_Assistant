
version: "3.8"

services:
  superset:
    image: apache/superset:latest
    container_name: superset_app
    restart: always
    ports:
      - "8088:8088"
    environment:
      - SUPERSET_SECRET_KEY=dev_secret_key_12345
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin
      - TALISMAN_ENABLED=False
    volumes:
      - ./superset_data:/app/superset_home
      - ./data:/data
    # We install duckdb-engine at runtime. 
    # Using 'sh -c' to ensure the environment is ready before starting the server.
    entrypoint: >
      /bin/sh -c "
      pip install --no-cache-dir duckdb-engine &&
      /usr/bin/run-server.sh
      "

  dev:
    image: mcr.microsoft.com/devcontainers/typescript-node:20
    container_name: voice_bi_dev
    init: true
    volumes:
      - .:/workspace:cached
    working_dir: /workspace
    # Standard devcontainer sleep to keep the container running
    command: sleep infinity
    depends_on:
      - superset
    environment:
      - API_KEY=${API_KEY}

networks:
  default:
    name: voice_bi_network
